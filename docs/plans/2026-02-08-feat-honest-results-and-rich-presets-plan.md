---
title: "feat: Honest Results + Rich Presets"
type: feat
date: 2026-02-08
---

# Honest Results + Rich Presets

## Overview

当前谈判系统存在两个产品层面的问题：
1. Prompt 过度偏向合作，几乎所有场景都达成共识 -- 这不真实，用户会觉得是"演戏"
2. 预设场景只有 3 个，且不填充身份字段，用户还需手动输入 Instance ID

目标：让产品结果真实可信，同时让预设体验完整、开箱即用。

## 问题分析

### "永远达成共识"为什么是坏的

- 用户会测试多个场景，如果全部达成共识，会认为系统在作弊
- 真实谈判有三种结果：达成共识、接近共识但有分歧、谈判破裂
- 黑客松评委会故意测试边界情况
- "接近但未达成"的结果同样有展示价值 -- convergence score + 最终方案建议

### 当前 prompt 的问题

`buildSystemPrompt` 中的"达成协议是首要目标"和"任何在可接受范围内的协议都比谈判破裂好"让 LLM 过于 eager。需要根据立场的实际兼容性来调整策略，而非一律促成。

## 方案

### 变更 1：5 个预设场景 + 自动填充身份

扩展 `PRESETS` 数组，每个预设增加 `instance_a_name` / `instance_b_name` 字段。覆盖三种预期结果。

| # | 场景 | 甲方身份 | 乙方身份 | 预期结果 | 设计意图 |
|---|------|---------|---------|---------|---------|
| 1 | 年终奖分配 | 研发总监 | 市场总监 | 达成共识 | 数字可分割，ZOPA 大（50-60 vs 40-50） |
| 2 | 周末聚餐 | 美食爱好者 | 效率达人 | 达成共识 | 双方都表达灵活性，容易折中 |
| 3 | 项目排期 | 后端负责人 | 前端负责人 | 达成共识 | 2-3 天差距很小，容易找到中间点 |
| 4 | 办公室温度 | 怕冷的设计师 | 怕热的程序员 | 接近共识 | 物理约束（一个空调），但有创意解法 |
| 5 | 远程办公政策 | 居家办公倡导者 | 到岗办公管理者 | 分歧较大 | 价值观冲突，核心诉求难以折中 |

具体立场设计：

**场景 4 - 办公室温度**（有趣、有创意空间）
- 甲方（怕冷的设计师）：希望空调设在 26 度，底线不低于 24 度。冬天更是不能低于 25 度。
- 乙方（怕热的程序员）：希望空调设在 22 度，底线不高于 23 度。服务器机房也需要降温。
- 分析：24 vs 23，ZOPA 只有 1 度的缝隙，可能达成也可能不达成。

**场景 5 - 远程办公政策**（价值观冲突）
- 甲方（居家办公倡导者）：全员每周至少 4 天远程办公，底线不低于 3 天。通勤浪费生命，远程效率更高。
- 乙方（到岗办公管理者）：全员每周至少 4 天到岗，底线不低于 3 天。面对面协作不可替代，企业文化需要线下维护。
- 分析：甲方底线（>=3天远程）和乙方底线（>=3天到岗）在一周 5 天里互斥，不可能同时满足。

**文件**：`src/app/negotiate/new/page.tsx`

**改动**：
1. `PRESETS` 数组增加 `instance_a_name` / `instance_b_name` 字段
2. `applyPreset` 函数同时填充 instanceAName / instanceBName
3. Instance ID 自动生成（kebab-case 的 name，如 "研发总监" -> "yan-fa-zong-jian" 或直接用 "agent-a-研发总监"）

### 变更 2：调整 prompt 平衡度

**文件**：`src/lib/negotiation.ts` (`buildSystemPrompt`)

当前 prompt 过度偏向合作。调整为：
- 删除"达成协议是首要目标"这种绝对性表述
- 改为"寻求双方都能接受的方案，但不要为了达成协议而突破底线"
- 最后一轮不再说"任何在可接受范围内的协议都比谈判破裂好"，改为"如果对方方案在可接受范围内就同意，否则坦诚说明分歧所在"
- 保留渐进让步要求（这是好的）

核心原则：**让 LLM 根据立场的实际兼容性来决定是否达成共识**，而非一律促成。

### 变更 3：优化"未达成共识"的结果展示

**文件**：`src/components/ResultCard.tsx`

当前问题：未达成共识时只显示一个黄色"未达成共识"标签，感觉像失败。

改为三级展示：

| convergence_score | 标签 | 颜色 | 含义 |
|---|---|---|---|
| >= 70 且 consensus_reached | "达成共识" | 绿色 | 完全成功 |
| >= 50 且 !consensus_reached | "接近共识" | 蓝色 | 有进展但未完全达成 |
| < 50 且 !consensus_reached | "分歧较大" | 琥珀色 | 核心分歧未解决 |

所有情况下都显示：
- convergence score 进度条（已有）
- 最终方案建议（已有 `final_proposal`）
- 双方让步记录
- 未解决分歧

"接近共识"和"分歧较大"时，额外显示一段引导文案：
- 接近共识："双方已在多个方面取得进展，以下是 AI 建议的折中方案"
- 分歧较大："双方在核心问题上存在根本分歧，以下是各方最终立场和 AI 建议"

### 变更 4：摘要 prompt 对应调整

**文件**：`src/lib/negotiation.ts` (`generateSummary`)

当前摘要 prompt 有 "你倾向于发现双方的共同点而非分歧" -- 这导致 LLM 有 bias。

改为中性表述："客观分析谈判结果，既要识别共同点也要如实反映分歧"。

同时调整 `convergence_score` 的评分指引，让 LLM 给出更有区分度的分数：
- 90-100：双方明确同意相同方案
- 70-89：核心条款基本一致，细节有差异
- 50-69：有部分共识但核心问题未解决
- 30-49：双方有让步但差距仍大
- 0-29：基本没有收敛

## 验收标准

- [ ] 5 个预设场景，点击后自动填充 topic + 双方 position + 双方 name
- [ ] Instance ID 自动生成，用户无需手动输入
- [ ] "年终奖" + "周末聚餐" 场景大概率达成共识
- [ ] "远程办公" 场景大概率不达成共识，但结果仍有展示价值
- [ ] 未达成共识时显示"接近共识"或"分歧较大"（非"未达成共识"）
- [ ] 所有结果都显示最终方案建议和 convergence score
- [ ] TypeScript 编译通过，lint 无新增错误

## 不做的事

- 不改变 3 轮谈判机制
- 不做动态共识检测
- 不改 SSE 协议
- 不改 LLM client 层

## 风险

| 风险 | 应对 |
|------|------|
| prompt 调松后连"年终奖"也不达成了 | 年终奖场景 ZOPA 足够大（50-60 vs 40-50），靠立场本身的兼容性保证 |
| convergence_score LLM 给分不准 | 在 prompt 中给出明确的分数区间定义 |
| 预设身份名用中文做 ID 可能有编码问题 | 用 "preset-a-1" / "preset-b-1" 这种安全格式 |
